-- phpMyAdmin SQL Dump
-- version 4.7.4
-- https://www.phpmyadmin.net/
--
-- Host: 127.0.0.1:3306
-- Generation Time: Nov 24, 2021 at 04:05 AM
-- Server version: 5.7.19
-- PHP Version: 5.6.31

SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
SET AUTOCOMMIT = 0;
START TRANSACTION;
SET time_zone = "+00:00";


/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8mb4 */;

--
-- Database: `flight db`
--

DELIMITER $$
--
-- Procedures
--
DROP PROCEDURE IF EXISTS `getFlightsByCity`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `getFlightsByCity` (IN `ORIGIN` VARCHAR(45))  BEGIN
	SELECT a1.city, d_date, a1.name as origin, d_time, 
			a2.name as destination, arr_time, airline.name as airline
	FROM flight, route, airport as a1, airport as a2, airline
	WHERE a1.city = ORIGIN
	AND flight.r_id = route.rid
	AND route.d_airport = a1.airport_id
	AND route.arr_airport = a2.airport_id
	AND flight.al_id = airline.alid;
END$$

DROP PROCEDURE IF EXISTS `ticket`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `ticket` (IN `email` VARCHAR(20))  NO SQL
SELECT fname,lname,ticketid,seatno,price,booking.fid,date,a1.city as origin, a2.city as destination from booking,airport as a1,airport AS a2,flight,route
WHERE booking.fid=flight.fid
AND flight.r_id=route.rid
AND route.arr_airport=a1.airport_id
AND route.d_airport=a2.airport_id
AND
booking.email=email$$

DROP PROCEDURE IF EXISTS `update1`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `update1` (IN `flightid` INT)  NO SQL
UPDATE flight
set flight.seats = flight.seats-1 where flight.fid=flightid$$

DELIMITER ;

-- --------------------------------------------------------

--
-- Table structure for table `airline`
--

DROP TABLE IF EXISTS `airline`;
CREATE TABLE IF NOT EXISTS `airline` (
  `alid` int(10) NOT NULL,
  `name` varchar(10) NOT NULL,
  `code` int(10) NOT NULL,
  `country` varchar(10) NOT NULL,
  PRIMARY KEY (`alid`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

--
-- Dumping data for table `airline`
--

INSERT INTO `airline` (`alid`, `name`, `code`, `country`) VALUES
(900, 'Lufthansa', 9, 'Germany'),
(901, 'Airasia', 6, 'Malaysia'),
(902, 'Jetairways', 11, 'India'),
(903, 'Indigo', 12, 'India'),
(904, 'Etihad', 265, 'UAE');

-- --------------------------------------------------------

--
-- Table structure for table `airport`
--

DROP TABLE IF EXISTS `airport`;
CREATE TABLE IF NOT EXISTS `airport` (
  `airport_id` int(5) NOT NULL,
  `name` varchar(20) NOT NULL,
  `city` varchar(20) NOT NULL,
  `country` varchar(20) NOT NULL,
  PRIMARY KEY (`airport_id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

--
-- Dumping data for table `airport`
--

INSERT INTO `airport` (`airport_id`, `name`, `city`, `country`) VALUES
(700, 'Kempegowda', 'Bangalore', 'India'),
(701, 'Rajiv Gandhi', 'Hyderabad', 'India'),
(702, 'Changi', 'Singapore', 'Singapore'),
(703, 'Kennedy', 'Newyork', 'USA'),
(704, 'Heathrow', 'London', 'UK'),
(705, 'Tullamarine', 'Melbourne', 'Australia');

-- --------------------------------------------------------

--
-- Table structure for table `booking`
--

DROP TABLE IF EXISTS `booking`;
CREATE TABLE IF NOT EXISTS `booking` (
  `ticketid` int(10) NOT NULL AUTO_INCREMENT,
  `fid` int(10) NOT NULL,
  `fname` varchar(30) NOT NULL,
  `lname` varchar(30) NOT NULL,
  `date` date NOT NULL,
  `seatno` int(11) NOT NULL,
  `email` varchar(30) NOT NULL,
  PRIMARY KEY (`ticketid`),
  UNIQUE KEY `uni` (`seatno`),
  KEY `jimmy` (`fid`)
) ENGINE=InnoDB AUTO_INCREMENT=27 DEFAULT CHARSET=latin1;

--
-- Dumping data for table `booking`
--

INSERT INTO `booking` (`ticketid`, `fid`, `fname`, `lname`, `date`, `seatno`, `email`) VALUES
(24, 200, 'sg', 's', '2022-11-08', 20, 'dell'),
(25, 200, 'shalini', 'shygan', '2022-11-16', 100, 'shalini2@gmail.com'),
(26, 200, 'shalini', 'shygan', '2022-11-16', 102, 'shalini22@gmail.com');

-- --------------------------------------------------------

--
-- Table structure for table `flight`
--

DROP TABLE IF EXISTS `flight`;
CREATE TABLE IF NOT EXISTS `flight` (
  `fid` int(10) NOT NULL,
  `d_time` time NOT NULL,
  `d_date` date NOT NULL,
  `arr_time` time NOT NULL,
  `arr_date` date NOT NULL,
  `r_id` int(10) NOT NULL,
  `seats` int(20) NOT NULL,
  `al_id` int(10) NOT NULL,
  `price` int(10) NOT NULL,
  PRIMARY KEY (`fid`),
  KEY `alid` (`al_id`),
  KEY `ridd` (`r_id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

--
-- Dumping data for table `flight`
--

INSERT INTO `flight` (`fid`, `d_time`, `d_date`, `arr_time`, `arr_date`, `r_id`, `seats`, `al_id`,`price`) VALUES
(200, '07:16:00', '2022-11-13', '10:29:00', '2022-11-14', 100, 180, 900,1500),
(201, '09:34:11', '2022-11-13', '09:35:00', '2022-11-14', 102, 300, 901,1400),
(202, '10:30:00', '2022-11-15', '22:30:00', '2022-11-16', 103, 200, 903,1700),
(203, '13:20:00', '2022-11-26', '22:30:00', '2022-11-26', 101, 130, 904,1600),
(204, '10:30:00', '2022-11-15', '22:30:00', '2022-11-16', 105, 300, 902,1800),
(205, '10:30:00', '2022-11-15', '22:30:00', '2022-11-16', 104, 150, 903,1300);

-- --------------------------------------------------------

--
-- Table structure for table `passenger`
--

DROP TABLE IF EXISTS `passenger`;
CREATE TABLE IF NOT EXISTS `passenger` (
  `fname` varchar(20) NOT NULL,
  `lname` varchar(20) NOT NULL,
  `mail` varchar(30) NOT NULL,
  `password` varchar(10) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

--
-- Dumping data for table `passenger`
--

INSERT INTO `passenger` (`fname`, `lname`, `mail`, `password`) VALUES
('shalini', 'shygan', 'shalini2@gmail.com', ''),
('fer', 'd', 'vtf', ''),
('shalini', 'shygan', 'shalinisg', '1234');

-- --------------------------------------------------------

--
-- Table structure for table `route`
--

DROP TABLE IF EXISTS `route`;
CREATE TABLE IF NOT EXISTS `route` (
  `rid` int(10) NOT NULL,
  `fid` int(10) NOT NULL,
  `d_airport` int(10) NOT NULL,
  `arr_airport` int(10) NOT NULL,
  PRIMARY KEY (`rid`),
  KEY `index` (`fid`),
  KEY `dair` (`d_airport`),
  KEY `aar` (`arr_airport`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

--
-- Dumping data for table `route`
--

INSERT INTO `route` (`rid`, `fid`, `d_airport`, `arr_airport`) VALUES
(100, 200, 700, 703),
(101, 203, 702, 701),
(102, 201, 705, 704),
(103, 202, 700, 704),
(104, 205, 703, 702),
(105, 204, 700, 702);

-- --------------------------------------------------------

--
-- Table structure for table `users`
--

DROP TABLE IF EXISTS `users`;
CREATE TABLE IF NOT EXISTS `users` (
  `email` varchar(100) NOT NULL,
  `password` varchar(100) NOT NULL,
  `id` int(100) NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (`email`),
  UNIQUE KEY `id` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1235 DEFAULT CHARSET=latin1;

--
-- Dumping data for table `users`
--

INSERT INTO `users` (`email`, `password`, `id`) VALUES
('shalini2@gmail.com', 'shalini12345', 1234);

--
-- Constraints for dumped tables
--

--
-- Constraints for table `booking`
--
ALTER TABLE `booking`
  ADD CONSTRAINT `fid_fk` FOREIGN KEY (`fid`) REFERENCES `flight` (`fid`) ON DELETE CASCADE;

--
-- Constraints for table `flight`
--
ALTER TABLE `flight`
  ADD CONSTRAINT `aid` FOREIGN KEY (`al_id`) REFERENCES `airline` (`alid`);
--
-- Constraints for table `route`
--

ALTER TABLE `route`
  ADD CONSTRAINT `air` FOREIGN KEY (`d_airport`) REFERENCES `airport` (`airport_id`),
  ADD CONSTRAINT `airport` FOREIGN KEY (`arr_airport`) REFERENCES `airport` (`airport_id`),
  ADD CONSTRAINT `fk` FOREIGN KEY (`fid`) REFERENCES `flight` (`fid`);
COMMIT;

/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
